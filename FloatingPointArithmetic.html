
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Floating Point Arithmetic &#8212; Elementary Computational Mathematics</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Interpolation" href="Interpolation.html" />
    <link rel="prev" title="Preface" href="preface.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      
      
      <h1 class="site-logo" id="site-title">Elementary Computational Mathematics</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="welcome.html">
                    Welcome to Elementary Computational Mathematics!
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Preface
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="preface.html">
   Preface
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Chapters
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Floating Point Arithmetic
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Interpolation.html">
   Interpolation
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/FloatingPointArithmetic.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#representation-of-real-numbers">
   Representation of Real Numbers
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#floating-point-numbers">
   Floating Point Numbers
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#rounding">
   Rounding
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#arithmetic-operations">
   Arithmetic Operations
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#error-accumulation-multiplication">
     Error Accumulation: Multiplication
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#error-accumulation-addition">
     Error Accumulation: Addition
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercises">
   Exercises
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#theoretical-part">
     Theoretical Part
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#computational-part">
     Computational Part
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#extended-reading">
   Extended Reading
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Floating Point Arithmetic</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#representation-of-real-numbers">
   Representation of Real Numbers
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#floating-point-numbers">
   Floating Point Numbers
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#rounding">
   Rounding
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#arithmetic-operations">
   Arithmetic Operations
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#error-accumulation-multiplication">
     Error Accumulation: Multiplication
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#error-accumulation-addition">
     Error Accumulation: Addition
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exercises">
   Exercises
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#theoretical-part">
     Theoretical Part
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#computational-part">
     Computational Part
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#extended-reading">
   Extended Reading
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="floating-point-arithmetic">
<span id="ch-fl-po-ar"></span><h1>Floating Point Arithmetic<a class="headerlink" href="#floating-point-arithmetic" title="Permalink to this headline">#</a></h1>
<p>In this chapter, we will introduce some basics on the real number system for modern computers and discuss the arithmetic operations of the number system.</p>
<section id="representation-of-real-numbers">
<span id="sec-re-re-nu"></span><h2>Representation of Real Numbers<a class="headerlink" href="#representation-of-real-numbers" title="Permalink to this headline">#</a></h2>
<p>Any nonzero real number <span class="math notranslate nohighlight">\(x\in \mathbb{R}\)</span> can be accurately represented with an infinite sequence of digits. This can be understood as the consequence that rational numbers are dense on any interval. Therefore, with the binary representation, we can write</p>
<div class="math notranslate nohighlight">
\[
x = \pm (0.d_1 d_2 d_3\dots d_{t-1} d_t d_{t+1}\dots) \times 2^e,
\]</div>
<p>where <span class="math notranslate nohighlight">\(e\)</span> is an integer exponent and <span class="math notranslate nohighlight">\(d_1=1\)</span>, the other binary digits <span class="math notranslate nohighlight">\(d_i\in \{0, 1\}\)</span>. The mantissa part</p>
<div class="math notranslate nohighlight">
\[
0.d_1 d_2 d_3\dots =  \frac{d_1}{2} + \frac{d_2}{2^2} + \frac{d_3}{2^3} + \cdots.
\]</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In order to guarantee the uniqueness of the above representation, we need further assumption that there exists an infinite subset <span class="math notranslate nohighlight">\(S\subset \mathbb{N}\)</span> that <span class="math notranslate nohighlight">\(d_j\neq 1\)</span> for <span class="math notranslate nohighlight">\(j\in S\)</span>. For example, under binary representation
<span class="math notranslate nohighlight">\(0.111\dots = (0.1)\times 2^1,\)</span>
then we will take the latter representation.</p>
</div>
</section>
<section id="floating-point-numbers">
<span id="sec-fl-po-nu"></span><h2>Floating Point Numbers<a class="headerlink" href="#floating-point-numbers" title="Permalink to this headline">#</a></h2>
<p>The floating point numbers generally refer to a set of real numbers with <strong>finite</strong> mantissa length. More precisely, we consider the set of real numbers <span class="math notranslate nohighlight">\(\mathbb{F} = \mathbb{F}(t, e_{\min}, e_{\max})\subset \mathbb{R}\)</span> that</p>
<div class="math notranslate nohighlight">
\[\mathbb{F} := \{x\in \mathbb{R} \mid x = \pm (0.d_1 d_2 d_3\dots d_{t-1} d_t) \times 2^e, d_1 =1,  e_{\min}\le e\le e_{\max}\}\cup \{0\}.\]</div>
<p>It can be seen that there are only finite numbers in <span class="math notranslate nohighlight">\(\mathbb{F}\)</span> with the smallest positive element <span class="math notranslate nohighlight">\(x_{\min} = 2^{e_{\min}-1}\)</span> and the largest element <span class="math notranslate nohighlight">\(x_{\max} = ( 1- 2^{-t} )\times 2^{e_{\max} }\)</span>. Therefore</p>
<div class="math notranslate nohighlight">
\[\mathbb{F}\subset \overline{\mathbb{F}}:= \{ x\in \mathbb{R}\mid x_{\min} \le |x| \le x_{\max}\}\cup \{ 0\}.\]</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The elements in <span class="math notranslate nohighlight">\(\mathbb{F}\)</span> are called normalized. If we  allow <span class="math notranslate nohighlight">\(d_1 = 0\)</span> in the definition of <span class="math notranslate nohighlight">\(\mathbb{F}\)</span>, then the numbers in the set are called denormalized.</p>
</div>
<div class="proof theorem admonition" id="THM-Di-Fl-Nu">
<p class="admonition-title"><span class="caption-number">Theorem 1 </span> (Distribution of Floating Numbers)</p>
<section class="theorem-content" id="proof-content">
<p>For any <span class="math notranslate nohighlight">\(e_{\min} \le e\le e_{\max}\)</span>, the distribution of the floating point number system <span class="math notranslate nohighlight">\(\mathbb{F}\)</span> on interval <span class="math notranslate nohighlight">\([2^{e-1}, 2^e]\)</span> is equidistant with distances of length <span class="math notranslate nohighlight">\(2^{e-t}\)</span>.</p>
</section>
</div><div class="proof admonition" id="proof">
<p>Proof. For any  <span class="math notranslate nohighlight">\(x \in \mathbb{F}\cap [2^{e-1}, 2^e]\)</span>, it can be represented by</p>
<div class="math notranslate nohighlight">
\[x = (0.d_1d_2\dots d_t)\times 2^{e}\]</div>
<p>where <span class="math notranslate nohighlight">\(d_1 = 1\)</span>. The mantissa is equidistantly distributed with distance <span class="math notranslate nohighlight">\(2^{-t}\)</span>, therefore the floating point numbers are equidistantly distributed with distances of length <span class="math notranslate nohighlight">\(2^{e-t}\)</span>.</p>
</div>
<p>To understand the approximation to real numbers by the floating point number system <span class="math notranslate nohighlight">\(\mathbb{F}\)</span>, it is important to consider the maximal relative distance between the numbers in <span class="math notranslate nohighlight">\(\overline{\mathbb{F}}\)</span> and their respective closest element in <span class="math notranslate nohighlight">\(\mathbb{F}\)</span>, which is the following quantity:</p>
<div class="math notranslate nohighlight">
\[\max_{x\in \overline{\mathbb{F}}, x\neq 0}\min_{z\in\mathbb{F}} \frac{|z - x|}{|x|}.\]</div>
<p>The following holds:</p>
<div class="proof theorem admonition" id="THM-Ma-Pr">
<p class="admonition-title"><span class="caption-number">Theorem 2 </span> (Machine Precision)</p>
<section class="theorem-content" id="proof-content">
<div class="math notranslate nohighlight">
\[\max_{x\in \overline{\mathbb{F}}, x\neq 0}\min_{z\in\mathbb{F}} \frac{|z - x|}{|x|}\le  2^{-t}.\]</div>
<p>The number <span class="math notranslate nohighlight">\(\mathrm{u} := 2^{-t}\)</span> is also called rounding unit or machine precision.</p>
</section>
</div><div class="proof admonition" id="proof">
<p>Proof. Without loss of generality, we only need to consider the positive numbers in <span class="math notranslate nohighlight">\(\overline{\mathbb{F}}\)</span>, then one can represent any nonzero <span class="math notranslate nohighlight">\(x\in [x_{\min}, x_{\max}]\)</span> by</p>
<div class="math notranslate nohighlight">
\[x = (0.d_1 d_2 \dots d_t\dots)\times 2^e\in [2^{e-1}, 2^e].\]</div>
<p>Since the floating point numbers are equidistantly distributed on <span class="math notranslate nohighlight">\([2^{e-1}, 2^e]\)</span> from <a class="reference internal" href="#THM-Di-Fl-Nu">Theorem 1</a>, one can find <span class="math notranslate nohighlight">\(z^{\ast}\in\mathbb{F}\)</span> such that</p>
<div class="math notranslate nohighlight">
\[|z^{\ast} - x| \le \frac{1}{2} 2^{e-t},\]</div>
<p>therefore</p>
<div class="math notranslate nohighlight">
\[\frac{|z^{\ast}- x|}{|x|}\le \frac{1}{2} 2^{e-t} \frac{1}{2^{e-1}} = 2^{-t}.\]</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>On modern computers, the following two floating point number systems</p>
<div class="math notranslate nohighlight">
\[\mathbb{F}_{32} := \mathbb{F}(24, -125, 128),\quad\mathbb{F}_{64} := \mathbb{F}(53, -1021, 1024)\]</div>
<p>are supported, they are often called single precision and double precision, respectively.</p>
</div>
</section>
<section id="rounding">
<span id="sec-rounding"></span><h2>Rounding<a class="headerlink" href="#rounding" title="Permalink to this headline">#</a></h2>
<p>The rounding operation <span class="math notranslate nohighlight">\(\textrm{fl}\)</span> is to map any real numbers of <span class="math notranslate nohighlight">\(\overline{\mathbb{F}}\)</span> into the floating point number system <span class="math notranslate nohighlight">\(\mathbb{F}\)</span> with smallest error. Such rounding operation can be written out explicitly, let <span class="math notranslate nohighlight">\(x = \pm (0.d_1 d_2\dots d_t d_{t+1}\dots )\times 2^e\)</span>, then</p>
<div class="math notranslate nohighlight">
\[\begin{split}
    \textrm{fl}(x) =\begin{cases}
        \pm (0.d_1 d_2\dots d_t) \times 2^e &amp; \text{if } d_{t+1} = 0,\\
        \pm (0.d_1 d_2\dots d_t  + 2^{-t}) \times 2^e &amp; \text{if } d_{t+1} = 1.
    \end{cases}
\end{split}\]</div>
<p>It is clear that rounding <span class="math notranslate nohighlight">\(\textrm{fl}\)</span> is monotone and idempotent, which means</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(x\le y \Rightarrow \textrm{fl}(x) \le \textrm{fl}(y)\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(\textrm{fl}(z) = z\)</span> if <span class="math notranslate nohighlight">\(z\in \mathbb{F}\)</span>.</p></li>
</ul>
<div class="proof theorem admonition" id="THM-REL-ERR">
<p class="admonition-title"><span class="caption-number">Theorem 3 </span></p>
<section class="theorem-content" id="proof-content">
<p>For any <span class="math notranslate nohighlight">\(x\in \overline{\mathbb{F}}\)</span>, <span class="math notranslate nohighlight">\(|\textrm{fl}(x) - x| = \min_{z\in \mathbb{F}} |z - x|\)</span>. If <span class="math notranslate nohighlight">\(x\neq 0\)</span>, then</p>
<div class="math notranslate nohighlight">
\[\frac{|\textrm{fl}(x) - x|}{|x|}\le \mathrm{u} = 2^{-t}.\]</div>
</section>
</div><div class="proof admonition" id="proof">
<p>Proof. The special case that <span class="math notranslate nohighlight">\(x = 0\)</span> is trivial, we only consider <span class="math notranslate nohighlight">\(x\in [x_{\min}, x_{\max}]\)</span>, it can be seen that</p>
<div class="math notranslate nohighlight">
\[
    |\textrm{fl}(x) - x| = | (0.d_1d_2\dots \tilde{d}_t) - (0.d_1d_2\dots d_t d_{t+1} \dots )|\times 2^e \le 2^{-(t+1)} \times 2^e,
\]</div>
<p>where <span class="math notranslate nohighlight">\(\tilde{d}_t\)</span> is the rounding bit, therefore</p>
<div class="math notranslate nohighlight">
\[
    \frac{|\textrm{fl}(x) - x|}{|x|} \le \frac{2^{e-(t+1)}}{2^{e-1}} = 2^{-t}.
\]</div>
</div>
<div class="proof corollary admonition" id="COR-REL-ERR">
<p class="admonition-title"><span class="caption-number">Corollary 1 </span></p>
<section class="corollary-content" id="proof-content">
<p>For any <span class="math notranslate nohighlight">\(x\in\overline{\mathbb{F}}\)</span>, <span class="math notranslate nohighlight">\(\textrm{fl}(x) = x(1+\delta)\)</span> with <span class="math notranslate nohighlight">\(|\delta|\le \mathrm{u}\)</span>.</p>
</section>
</div></section>
<section id="arithmetic-operations">
<span id="sec-ar-op"></span><h2>Arithmetic Operations<a class="headerlink" href="#arithmetic-operations" title="Permalink to this headline">#</a></h2>
<p>Let <span class="math notranslate nohighlight">\(\mathbb{F} = \mathbb{F}(t, e_{\min}, e_{\max})\)</span> be a given floating point number system and we consider the basic binary operation <span class="math notranslate nohighlight">\(\circ\in \{ +, -, *, /\}\)</span> on <span class="math notranslate nohighlight">\(\mathbb{F}\)</span>, in order to represent the outcome in <span class="math notranslate nohighlight">\(\mathbb{F}\)</span>, a straightforward realization is to define the binary operation <span class="math notranslate nohighlight">\(\boxed{\circ}\)</span> as the following (for the case of division, we assume <span class="math notranslate nohighlight">\(y\neq 0\)</span>):</p>
<div class="math notranslate nohighlight">
\[x \,\boxed{\circ}\, y := \textrm{fl}(x\circ y),\]</div>
<p>then for any <span class="math notranslate nohighlight">\(x, y\in\mathbb{F}\)</span>, if <span class="math notranslate nohighlight">\(x\circ y\in \overline{\mathbb{F}}\)</span>, then <span class="math notranslate nohighlight">\(x \,\boxed{\circ}\, y = (x\circ y)(1 + \delta)\)</span> with <span class="math notranslate nohighlight">\(|\delta| \le \mathrm{u}\)</span> from the <a class="reference internal" href="#COR-REL-ERR">Corollary 1</a>.</p>
<div class="proof remark admonition" id="remark-4">
<p class="admonition-title"><span class="caption-number">Remark 1 </span> (Cancellation Error)</p>
<section class="remark-content" id="proof-content">
<p>If <span class="math notranslate nohighlight">\(x, y\in\mathbb{R}\)</span>, then the relative error from the following binary operation <span class="math notranslate nohighlight">\(\textrm{fl}(x)\,\boxed{+}\,\textrm{fl}(y)\)</span> can be estimated by</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
\frac{|\textrm{fl}(x)\,\boxed{+}\,\textrm{fl}(y)- (x +  y) |}{|x + y|} &amp;\le \frac{|\textrm{fl}(x)\,\boxed{+}\,\textrm{fl}(y) - (\textrm{fl}(x) +  \textrm{fl}(y)) |}{|x + y|} + \frac{| (\textrm{fl}(x) +  \textrm{fl}(y)) - (x+y)   |}{|x+y|}\\  
&amp;\le\mathrm{u} + (\mathrm{u} +\mathrm{u}^2) \frac{|x|+|y|}{|x+y|}.
\end{aligned}
\end{split}\]</div>
<p>When <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span> are close in magnitude but with opposite signs, the cancellation error will be significant.</p>
</section>
</div><section id="error-accumulation-multiplication">
<span id="ssec-er-ac-mu"></span><h3>Error Accumulation: Multiplication<a class="headerlink" href="#error-accumulation-multiplication" title="Permalink to this headline">#</a></h3>
<p>For complicated computations on modern computers, the errors from arithmetic operations will accumulate towards the final result (we do not consider techniques such as fused multiply-add (FMA) here). To quantify the accumulation effect, we will need the following lemma.</p>
<div class="proof lemma admonition" id="LEM-ACC">
<p class="admonition-title"><span class="caption-number">Lemma 1 </span></p>
<section class="lemma-content" id="proof-content">
<p>For real numbers <span class="math notranslate nohighlight">\(a_1, a_2, \dots, a_n\)</span> with <span class="math notranslate nohighlight">\(|a_k|\le \delta\)</span> for <span class="math notranslate nohighlight">\(k=1,\dots, n\)</span>, then for <span class="math notranslate nohighlight">\(n\delta &lt; 1\)</span>, the following holds</p>
<div class="math notranslate nohighlight">
\[\prod_{k=1}^n (1 + a_k) = 1 + b_n,\]</div>
<p>where <span class="math notranslate nohighlight">\(|b_n| \le \frac{n\delta}{1 - n\delta}\)</span>.</p>
</section>
</div><div class="proof admonition" id="proof">
<p>Proof. The proof is quite easy with induction. When <span class="math notranslate nohighlight">\(n=1\)</span>, <span class="math notranslate nohighlight">\(|b_1| = |a_1|\le \delta \le \frac{\delta}{1 - \delta}\)</span>. Suppose the claim holds for <span class="math notranslate nohighlight">\(n = m\)</span>, then for <span class="math notranslate nohighlight">\(n = m +1\)</span>, we could see that</p>
<div class="math notranslate nohighlight">
\[
    \prod_{k=1}^{m+1} (1 + a_k) = (1 + b_m) (1 + a_{m+1}) = 1 + b_{m+1}, 
\]</div>
<p>which implies that <span class="math notranslate nohighlight">\(b_{m+1} = b_m + a_{m+1} + a_{m+1}b_m\)</span>, with the given bounds on <span class="math notranslate nohighlight">\(a_{m+1}\)</span> and <span class="math notranslate nohighlight">\(b_m\)</span>, we can estimate</p>
<div class="math notranslate nohighlight">
\[
    |b_{m+1}| = | b_m + a_{m+1} + a_{m+1}b_m | \le \frac{(m+1)\delta}{1 - m\delta} \le \frac{(m+1)\delta}{1 - (m+1)\delta}.
\]</div>
</div>
<p>In the following, we consider the naive floating point product <span class="math notranslate nohighlight">\(P_n\)</span> of <span class="math notranslate nohighlight">\(n\)</span> real numbers <span class="math notranslate nohighlight">\(\{x_j\}_{j=1}^n \subset \mathbb{R}\)</span> with assumption that <span class="math notranslate nohighlight">\((2n-1)\textrm{u} &lt; 1\)</span> by the following iteration</p>
<div class="math notranslate nohighlight">
\[\begin{split}\newcommand{\fl}[1]{\textrm{fl}(#1)}
    \begin{cases}
        P_k =\fl{x_1} &amp; k=1,\\
        P_k = P_{k-1}~\boxed{\ast}~ \fl{x_k} &amp; k\ge 2.
    \end{cases}
\end{split}\]</div>
<p>Let <span class="math notranslate nohighlight">\(\fl{x_k} = x_k(1 + \tau_k)\)</span>, then <span class="math notranslate nohighlight">\(|\tau_k|\le \textrm{u}\)</span>. From the <span class="math notranslate nohighlight">\(n\)</span>-th iteration step</p>
<div class="math notranslate nohighlight">
\[
P_n = P_{n-1}~\boxed{\ast}~ \fl{x_n} = \fl{\fl{P_{n-1}}\fl{x_n}} = \fl{P_{n-1}}\fl{x_n}(1 + \delta_n)
\]</div>
<p>such that <span class="math notranslate nohighlight">\(|\delta_n|\le \textrm{u}\)</span>. Since <span class="math notranslate nohighlight">\(P_{n-1}\in \mathbb{F}\)</span>, <span class="math notranslate nohighlight">\(\fl{P_{n-1}} = P_{n-1}\)</span>, then</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
    P_n &amp;= P_{n-1} \fl{x_n}(1 + \delta_n) = P_{n-2} \fl{x_{n-1}}(1 + \delta_{n-1}) (1 + \delta_n) = \cdots \\
    &amp;=  \fl{x_1} \fl{x_2}\cdots \fl{x_n} \prod_{j=2}^n (1 + \delta_j) \\
    &amp;= \prod_{j=1}^n x_j (1 + \tau_j)  \prod_{j=2}^n (1 + \delta_j) \\
    &amp;\le \left(\prod_{j=1}^n x_j \right) (1 + \eta_n),
\end{aligned}
\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(|\eta_n|\le \frac{(2n-1)\textrm{u}}{1 - (2n-1)\textrm{u}}\)</span>.</p>
</section>
<section id="error-accumulation-addition">
<span id="ssec-er-ac-ad"></span><h3>Error Accumulation: Addition<a class="headerlink" href="#error-accumulation-addition" title="Permalink to this headline">#</a></h3>
<p>For the naive floating point summation <span class="math notranslate nohighlight">\(S_n\)</span> of <span class="math notranslate nohighlight">\(n\)</span> real numbers <span class="math notranslate nohighlight">\(\{x_j \}_{j=1}^n\)</span> by the iteration</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{cases}
    S_k = 0 &amp; k=0,\\
    S_k = S_{k-1}~\boxed{+}~ \fl{x_k} &amp; k\ge 1,
\end{cases}
\end{split}\]</div>
<p>we can carry out a similar analysis. Let <span class="math notranslate nohighlight">\(S^{\ast}_j = \sum_{k=1}^j x_k\)</span> and  <span class="math notranslate nohighlight">\(\fl{x_k} = x_k ( 1 + \tau_k)\)</span> for <span class="math notranslate nohighlight">\(|\tau_k|\le \textrm{u}\)</span>, denote <span class="math notranslate nohighlight">\(\Delta S_j =     S_j^{\ast} - S_j\)</span>, then</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
    \Delta S_j &amp;= S_j^{\ast} - S_j \\&amp;= S_{j}^{\ast} - ( S_{j-1}~\boxed{+}~ \fl{x_j}) \\
    &amp;=  S_{j}^{\ast}  - ( S_{j}^{\ast} - \Delta S_{j-1} + x_j\tau_j)(1 + \delta_j) \\
    &amp;= \Delta S_{j-1}(1 + \delta_j) - \delta_j S_{j}^{\ast} - x_j(\tau_j)(1+\delta_j),
\end{aligned}
\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(|\delta_j|\le \textrm{u}\)</span>. Therefore</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
    |\Delta S_j|&amp;\le |\Delta S_{j-1}|(1 + \textrm{u}) + (\sum_{k=1}^j |x_k|)\textrm{u} + |x_j| \textrm{u}(1 + \textrm{u}) \\
    &amp;\le |\Delta S_{j-2}|(1 + \textrm{u})^2 + (\sum_{k=1}^j |x_k|)\textrm{u}(1+\textrm{u}) + |x_j| \textrm{u}(1 + \textrm{u})^2 \\
    &amp;\quad\quad +  (\sum_{k=1}^{j-1} |x_k|)\textrm{u} + |x_{j-1}| \textrm{u}(1 + \textrm{u})\\
    &amp;\le |\Delta S_{j-3}|(1 + \textrm{u})^3 + (\sum_{k=1}^j |x_k|)\textrm{u}(1+\textrm{u})^2 + |x_j| \textrm{u}(1 + \textrm{u})^3 \\
    &amp;\quad\quad +  (\sum_{k=1}^{j-1} |x_k|)\textrm{u}(1 + \textrm{u}) + |x_{j-1}| \textrm{u}(1 + \textrm{u})^2 \\
    &amp;\quad\quad +  (\sum_{k=1}^{j-2} |x_k|)\textrm{u}+ |x_{j-2}| \textrm{u}(1 + \textrm{u})\\
    &amp;\le  \cdots \\
    &amp;\le  \sum_{l=1}^{j} \left( (\sum_{k=1}^l |x_k|) \textrm{u}(1 + \textrm{u})^{l-1} + |x_{l}|\text{u}(1 + \textrm{u})^{l-1} \right) \\
    &amp; \le \sum_{l=1}^{j} \left( (\sum_{k=1}^j |x_k|) \textrm{u}(1 + \textrm{u})^{l-1} \right) + \left(\sum_{l=1}^j |x_{l}|\right)\text{u}(1 + \textrm{u})^{j-1}\\
    &amp;= \left(\sum_{l=1}^j |x_{l}|\right) ((1 + \textrm{u})^j - 1)
\end{aligned}
\end{split}\]</div>
<p>Using the previous lemma will provide an estimate of <span class="math notranslate nohighlight">\( ((1 + \textrm{u})^j - 1)\)</span> as long as <span class="math notranslate nohighlight">\(j\textrm{u} &lt; 1\)</span>.</p>
</section>
</section>
<section id="exercises">
<span id="sec-ch1-exer"></span><h2>Exercises<a class="headerlink" href="#exercises" title="Permalink to this headline">#</a></h2>
<p>Assume <span class="math notranslate nohighlight">\(n\in \mathbb{N}\)</span> and <span class="math notranslate nohighlight">\(n\textrm{u} &lt; 1\)</span>, let <span class="math notranslate nohighlight">\(\{x_j\}_{j=1}^n\)</span> be a sequence of real numbers, <span class="math notranslate nohighlight">\(\textrm{fl}:\overline{\mathbb{F}}\mapsto \mathbb{F}\)</span> is the rounding operation, <span class="math notranslate nohighlight">\(\textrm{u}\)</span> is the machine epsilon. In the following, we briefly discuss the rounding error for floating point summation (sum reduction).</p>
<div class="proof definition admonition" id="definition-6">
<p class="admonition-title"><span class="caption-number">Definition 1 </span></p>
<section class="definition-content" id="proof-content">
<p>A reduction <span class="math notranslate nohighlight">\(\Pi\)</span> of the floating point summation</p>
<div class="math notranslate nohighlight">
\[
\fl{x_1} ~\boxed{+}~ \fl{x_2} ~\boxed{+}~\cdots ~\boxed{+}~ \fl{x_n}
\]</div>
<p>is an evaluation order for the <span class="math notranslate nohighlight">\(~\boxed{+}~\)</span> operations. For example, <span class="math notranslate nohighlight">\(n = 4\)</span>, then the reduction <span class="math notranslate nohighlight">\(\Pi = (3,1,2)\)</span> is corresponding to the following calculation</p>
<div class="math notranslate nohighlight">
\[
\fl{x_1} ~\boxed{+}~ \fl{x_2} + \underbrace{(\fl{x_3} ~\boxed{+}~ \fl{x_4})}_{=y_1}\to \underbrace{(\fl{x_1} ~\boxed{+}~ \fl{x_2})}_{=y_2} ~\boxed{+}~ y_1 \to \underbrace{(y_2 ~\boxed{+}~ y_1)}_{=y_3},
\]</div>
<p>where <span class="math notranslate nohighlight">\(y_i\)</span> denotes the result of <span class="math notranslate nohighlight">\(i\)</span>-th <span class="math notranslate nohighlight">\(\boxed{+}\)</span> operation in the reduction. Obviously the final summation will be <span class="math notranslate nohighlight">\(y_{n-1}\)</span>. We denote <span class="math notranslate nohighlight">\(T_n(\Pi)\)</span> be the result of floating point summation with reduction order <span class="math notranslate nohighlight">\(\Pi\)</span>.</p>
</section>
</div><section id="theoretical-part">
<span id="ssec-ch1-exer-theory"></span><h3>Theoretical Part<a class="headerlink" href="#theoretical-part" title="Permalink to this headline">#</a></h3>
<div class="admonition-problem-1 admonition">
<p class="admonition-title">Problem 1</p>
<p>Prove that the native summation has following error bound</p>
<div class="math notranslate nohighlight">
\[
|T_n(\Pi) - S_n|\le \left( \frac{\textrm{u} n }{1 - \textrm{u} n } \right)\sum_{j=1}^n |x_j|,
\]</div>
<p>where <span class="math notranslate nohighlight">\(S_n = \sum_{j=1}^n x_j\)</span> and <span class="math notranslate nohighlight">\(\Pi = (1,2,\dots, (n-1))\)</span>.</p>
</div>
<div class="admonition-problem-2 admonition">
<p class="admonition-title">Problem 2</p>
<p>Prove that</p>
<div class="math notranslate nohighlight">
\[
\min_{\Pi}|T_n(\Pi) - S_n| \le \left(\frac{ \textup{u} H }{1 - \textup{u} H  }\right)\sum_{j=1}^n |x_j|,
\]</div>
<p>where <span class="math notranslate nohighlight">\(H = \lceil\log_2 n \rceil\)</span> and <span class="math notranslate nohighlight">\(T_n(\Pi)\)</span> is the floating point summation with reduction order <span class="math notranslate nohighlight">\(\Pi\)</span>.</p>
</div>
<div class="admonition-problem-3-horner-s-scheme admonition">
<p class="admonition-title">Problem 3 (Horner’s scheme)</p>
<p>The evaluation of polynomial</p>
<div class="math notranslate nohighlight">
\[
p(x) = a_0 + a_1 x + \dots + a_n x^n
\]</div>
<p>is mostly using Horner’s scheme, which writes the polynomial in ‘nested’ form:</p>
<div class="math notranslate nohighlight">
\[
p(x) = a_0 + x (a_1 + x(a_2 + \dots x(a_{n-1} + x(a_n)))).
\]</div>
<p>Please find an upper bound of the rounding error for this scheme.</p>
</div>
</section>
<section id="computational-part">
<span id="ssec-ch1-exer-comp"></span><h3>Computational Part<a class="headerlink" href="#computational-part" title="Permalink to this headline">#</a></h3>
<div class="admonition-problem-4-pairwise-summation admonition">
<p class="admonition-title">Problem 4 (Pairwise summation)</p>
<p>Based on theoretical part, implement an algorithm for the summation <span class="math notranslate nohighlight">\(\sum_{j=1}^n x_j\)</span> which has <span class="math notranslate nohighlight">\(\mathcal{O}(\textrm{u}\log_2 n)\)</span> rounding error.</p>
</div>
<div class="admonition-problem-5-kahan-compensated-summation admonition">
<p class="admonition-title">Problem 5 (Kahan compensated summation)</p>
<p>Suppose <span class="math notranslate nohighlight">\(a, b\in\mathbb{R}\)</span>, the rounding error for the sum <span class="math notranslate nohighlight">\(s = \fl{\fl{a}+\fl{b}}\)</span> (<span class="math notranslate nohighlight">\(a\ge b\)</span>) can be computed using</p>
<div class="math notranslate nohighlight">
\[
\fl{\fl{s - \fl{a}}-\fl{b}}
\]</div>
<p>Based on this property, one can keep tracking of the rounding error.</p>
<div class="proof algorithm admonition" id="AL-KA-CO-SU">
<p class="admonition-title"><span class="caption-number">Algorithm 1 </span> (Kahan Compensated Summation)</p>
<section class="algorithm-content" id="proof-content">
<p><strong>Inputs</strong> <span class="math notranslate nohighlight">\(\{x_j\}_{j=1}^n\subset \mathbb{R}\)</span></p>
<p><strong>Outputs</strong> <span class="math notranslate nohighlight">\(s_n = \sum_{j=1}^n x_j\)</span></p>
<ol class="simple">
<li><p><span class="math notranslate nohighlight">\(j\gets 1\)</span>, <span class="math notranslate nohighlight">\(e_j \gets 0\)</span>, <span class="math notranslate nohighlight">\(s_j \gets x_j\)</span> //    initialization;</p></li>
<li><p>While <span class="math notranslate nohighlight">\(j &lt; n\)</span>:</p>
<ol class="simple">
<li><p><span class="math notranslate nohighlight">\(j\gets j + 1\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(y_j = x_j - e_{j-1}\)</span> //remove compensated error;</p></li>
<li><p><span class="math notranslate nohighlight">\(s_j = s_{j-1} + y_j\)</span> //perform summation;</p></li>
<li><p><span class="math notranslate nohighlight">\(e_j = (s_j - s_{j-1}) - y_j\)</span> //restore the rounding error;</p></li>
</ol>
</li>
</ol>
</section>
</div><p>Implement the <a class="reference internal" href="#AL-KA-CO-SU">Algorithm 1</a> described above and compare the accuracy with naive summation and pairwise summation with test cases.</p>
</div>
<div class="admonition-problem-6 admonition">
<p class="admonition-title">Problem 6</p>
<p>Suppose the inputs <span class="math notranslate nohighlight">\(\{x_j\}_{j=1}^n\subset \mathbb{R}\)</span> are randomly distributed (say <span class="math notranslate nohighlight">\(x_j\sim U(0,1)\)</span> i.i.d), what is growth of the expected rounding error with respect to total number of inputs <span class="math notranslate nohighlight">\(n\)</span> for the naive summation and pairwise summation? Please provide an explanation of your result. You can use Kahan sum as the accurate result approximately.</p>
</div>
</section>
</section>
<section id="extended-reading">
<h2>Extended Reading<a class="headerlink" href="#extended-reading" title="Permalink to this headline">#</a></h2>
<p>See <span id="id1">[<a class="reference internal" href="#id4" title="Nicholas J Higham. The accuracy of floating point summation. SIAM Journal on Scientific Computing, 14(4):783–799, 1993.">Higham, 1993</a>, <a class="reference internal" href="#id3" title="Nicholas J Higham and Theo Mary. A new approach to probabilistic rounding error analysis. SIAM Journal on Scientific Computing, 41(5):A2815–A2835, 2019.">Higham and Mary, 2019</a>, <a class="reference internal" href="#id5" title="Jean-Michel Muller. Elementary functions. Springer, 2006.">Muller, 2006</a>]</span>.</p>
<div class="docutils container" id="id2">
<dl class="citation">
<dt class="label" id="id4"><span class="brackets"><a class="fn-backref" href="#id1">Hig93</a></span></dt>
<dd><p>Nicholas J Higham. The accuracy of floating point summation. <em>SIAM Journal on Scientific Computing</em>, 14(4):783–799, 1993.</p>
</dd>
<dt class="label" id="id3"><span class="brackets"><a class="fn-backref" href="#id1">HM19</a></span></dt>
<dd><p>Nicholas J Higham and Theo Mary. A new approach to probabilistic rounding error analysis. <em>SIAM Journal on Scientific Computing</em>, 41(5):A2815–A2835, 2019.</p>
</dd>
<dt class="label" id="id5"><span class="brackets"><a class="fn-backref" href="#id1">Mul06</a></span></dt>
<dd><p>Jean-Michel Muller. <em>Elementary functions</em>. Springer, 2006.</p>
</dd>
</dl>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="preface.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Preface</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="Interpolation.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Interpolation</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Yimin Zhong<br/>
  
      &copy; Copyright 2022. CC BY-NC-SA 4.0.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>